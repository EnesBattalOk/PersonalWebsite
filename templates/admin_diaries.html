{% extends "admin_base.html" %}

{% block title %}GÃ¼nlÃ¼kler ve YÄ±llÄ±klar{% endblock %}

{% block content %}
<div class="pb-20">
    <div class="flex items-center justify-between mb-8">
        <h1 class="text-3xl font-bold text-white">GÃ¼nlÃ¼k KayÄ±tlar</h1>
        <div class="flex items-center gap-4">
            <div class="flex bg-slate-800/50 p-1 rounded-xl border border-slate-700">
                <button onclick="switchTab('gunluk')" id="tab-btn-gunluk" class="px-6 py-2 rounded-lg text-sm font-bold transition-all bg-violet-600 text-white shadow-lg shadow-violet-500/20">
                    GÃ¼nlÃ¼k Notlar
                </button>
                <button onclick="switchTab('yillik')" id="tab-btn-yillik" class="px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white">
                    YÄ±llÄ±k KayÄ±tlar
                </button>
            </div>
            <button onclick="openModal()" class="px-6 py-2.5 bg-violet-600 hover:bg-violet-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-violet-500/20 transform hover:scale-105">
                <i class="fas fa-plus mr-2"></i> Yeni KayÄ±t
            </button>
        </div>
    </div>

    <!-- GÃ¼nlÃ¼k Notlar Sekmesi -->
    <div id="tab-gunluk" class="tab-content">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for gunluk in gunlukler %}
            {% set border_color = 'border-slate-700' %}
            {% if gunluk.duygu == 'harika' %}{% set border_color = 'border-yellow-400' %}
            {% elif gunluk.duygu == 'iyi' %}{% set border_color = 'border-violet-500' %}
            {% elif gunluk.duygu == 'orta' %}{% set border_color = 'border-blue-400' %}
            {% elif gunluk.duygu == 'kotu' %}{% set border_color = 'border-red-500' %}
            {% endif %}
            
            <div class="bg-slate-800/40 border-2 {{ border_color }} rounded-2xl p-6 hover:transform hover:scale-[1.02] transition-all shadow-xl group relative overflow-hidden flex flex-col h-full">
                <div class="flex justify-between items-start mb-4">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">{{ gunluk.tarih.strftime('%d %B %Y') }}</span>
                    <a href="{{ url_for('delete_diary', id=gunluk.id) }}" onclick="return confirm('Silmek istediÄŸinize emin misiniz?')" class="text-slate-600 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100">
                        <i class="fas fa-trash-alt"></i>
                    </a>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">{{ gunluk.baslik }}</h3>
                <div class="text-slate-400 text-sm flex-grow mb-4 prose prose-invert prose-sm max-w-none line-clamp-6">
                    {{ gunluk.icerik|safe }}
                </div>
                <div class="flex items-center justify-between mt-auto pt-4 border-t border-slate-700/50">
                    <div class="flex items-center gap-2">
                        {% if gunluk.duygu %}
                        <span class="w-2 h-2 rounded-full 
                            {% if gunluk.duygu == 'harika' %}bg-yellow-400
                            {% elif gunluk.duygu == 'iyi' %}bg-violet-500
                            {% elif gunluk.duygu == 'orta' %}bg-blue-400
                            {% else %}bg-red-500{% endif %}"></span>
                        <span class="text-[10px] font-bold text-slate-500 uppercase">
                            {% if gunluk.duygu == 'harika' %}ðŸŒŸ Harika
                            {% elif gunluk.duygu == 'iyi' %}ðŸ’œ Ä°yi
                            {% elif gunluk.duygu == 'orta' %}ðŸ”µ Orta
                            {% else %}ðŸ”´ KÃ¶tÃ¼{% endif %}
                        </span>
                        {% endif %}
                    </div>
                    <button onclick="viewDiary({{ gunluk.id }})" class="text-violet-400 hover:text-violet-300 text-xs font-bold uppercase tracking-widest transition-colors">
                        TamamÄ±nÄ± Oku
                    </button>
                </div>
            </div>
            {% endfor %}
            {% if not gunlukler %}
            <div class="col-span-full py-20 text-center bg-slate-800/20 rounded-3xl border border-dashed border-slate-700">
                <i class="fas fa-pen-nib text-slate-600 text-4xl mb-4"></i>
                <p class="text-slate-500 italic">HenÃ¼z gÃ¼nlÃ¼k not eklenmemiÅŸ.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- YÄ±llÄ±k KayÄ±tlar Sekmesi -->
    <div id="tab-yillik" class="tab-content hidden space-y-4">
        {% for yillik in yilliklar %}
        <div class="bg-slate-800/40 border border-slate-700 rounded-2xl p-6 flex items-center gap-8 hover:bg-slate-800/60 transition-all group">
            <div class="text-4xl font-black text-slate-700 group-hover:text-violet-500/50 transition-colors">
                {{ yillik.tarih.strftime('%Y') }}
            </div>
            <div class="flex-1">
                <h3 class="text-xl font-bold text-white mb-1">{{ yillik.baslik }}</h3>
                <div class="text-slate-400 text-sm line-clamp-1 italic">{{ yillik.icerik|safe }}</div>
            </div>
            <div class="flex items-center gap-4">
                <span class="text-xs font-medium text-slate-500">{{ yillik.tarih.strftime('%d.%m.%Y') }}</span>
                <a href="{{ url_for('delete_diary', id=yillik.id) }}" onclick="return confirm('Silmek istediÄŸinize emin misiniz?')" class="text-slate-600 hover:text-red-500 transition-colors p-2">
                    <i class="fas fa-trash-alt"></i>
                </a>
            </div>
        </div>
        {% endfor %}
        {% if not yilliklar %}
        <div class="py-20 text-center bg-slate-800/20 rounded-3xl border border-dashed border-slate-700">
            <i class="fas fa-calendar-check text-slate-600 text-4xl mb-4"></i>
            <p class="text-slate-500 italic">HenÃ¼z yÄ±llÄ±k kayÄ±t eklenmemiÅŸ.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal -->
<div id="add-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm">
    <div class="bg-slate-900 border border-slate-700 rounded-3xl w-full max-w-4xl overflow-hidden shadow-2xl flex flex-col max-h-[95vh]">
        <div class="p-6 border-b border-slate-800 flex justify-between items-center">
            <h3 class="text-xl font-bold text-white">Yeni KayÄ±t Ekle</h3>
            <button onclick="closeModal()" class="text-slate-400 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <form action="{{ url_for('add_diary') }}" method="POST" class="p-6 space-y-6 overflow-y-auto flex-grow">
            <!-- 1. Gizli TÃ¼r SeÃ§imi (Sekmeye gÃ¶re otomatik gÃ¼ncellenebilir ama radio olarak kalsÄ±n) -->
            <div class="flex gap-8 items-center bg-slate-950/50 p-4 rounded-2xl border border-slate-800">
                <span class="text-sm font-bold text-slate-400 uppercase tracking-widest">KayÄ±t TÃ¼rÃ¼:</span>
                <label class="flex items-center gap-2 cursor-pointer group">
                    <input type="radio" name="tur" value="GUNLUK" checked onchange="toggleEmotion(true)" class="hidden peer">
                    <div class="w-5 h-5 border-2 border-slate-700 rounded-full flex items-center justify-center peer-checked:border-violet-500 peer-checked:bg-violet-500/20 transition-all">
                        <div class="w-2 h-2 bg-violet-500 rounded-full opacity-0 peer-checked:opacity-100 transition-all"></div>
                    </div>
                    <span class="text-slate-400 group-hover:text-white transition-colors font-medium">GÃ¼nlÃ¼k Not</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer group">
                    <input type="radio" name="tur" value="YILLIK" onchange="toggleEmotion(false)" class="hidden peer">
                    <div class="w-5 h-5 border-2 border-slate-700 rounded-full flex items-center justify-center peer-checked:border-violet-500 peer-checked:bg-violet-500/20 transition-all">
                        <div class="w-2 h-2 bg-violet-500 rounded-full opacity-0 peer-checked:opacity-100 transition-all"></div>
                    </div>
                    <span class="text-slate-400 group-hover:text-white transition-colors font-medium">YÄ±llÄ±k KayÄ±t</span>
                </label>
            </div>

            <!-- 2. BaÅŸlÄ±k AlanÄ± -->
            <div class="space-y-2">
                <label class="block text-sm font-bold text-slate-300 uppercase tracking-widest">BaÅŸlÄ±k</label>
                <input type="text" name="baslik" required placeholder="Neler oldu?" class="w-full px-4 py-3 bg-slate-950 border border-slate-800 rounded-xl text-white focus:border-violet-500 outline-none transition-all placeholder:text-slate-600">
            </div>

            <!-- 3. Duygu Durumu SeÃ§ici -->
            <div id="emotion-section" class="space-y-3">
                <label class="block text-sm font-bold text-slate-300 uppercase tracking-widest">Duygu Durumu</label>
                <div class="flex gap-4">
                    {% for mood in [('harika', 'ðŸŒŸ', 'Harika'), ('iyi', 'ðŸ’œ', 'Ä°yi'), ('orta', 'ðŸ”µ', 'Orta'), ('kotu', 'ðŸ”´', 'KÃ¶tÃ¼')] %}
                    <label class="flex-1 cursor-pointer group">
                        <input type="radio" name="duygu" value="{{ mood[0] }}" {% if loop.first %}checked{% endif %} class="hidden peer">
                        <div class="flex flex-col items-center gap-2 p-4 rounded-2xl border-2 border-slate-800 bg-slate-900 peer-checked:border-violet-500 peer-checked:bg-violet-500/10 transition-all hover:border-slate-700">
                            <span class="text-3xl grayscale group-hover:grayscale-0 peer-checked:grayscale-0 transition-all">{{ mood[1] }}</span>
                            <span class="text-xs font-bold text-slate-500 peer-checked:text-violet-400">{{ mood[2] }}</span>
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- 4. Ä°Ã‡ERÄ°K ALANI (EditÃ¶r) -->
            <div class="mb-6">
                <label class="block text-sm font-bold mb-2 text-slate-300 uppercase tracking-widest">Ä°Ã§erik</label>
                <div class="editor-container">
                    <textarea name="icerik" id="editor_main" rows="10"></textarea>
                </div>
            </div>

            <!-- 5. Butonlar -->
            <div class="flex justify-end gap-4 pt-6 border-t border-slate-800 mt-6 sticky bottom-0 bg-slate-900 pb-2">
                <button type="button" onclick="closeModal()" class="px-6 py-3 text-slate-400 hover:text-white font-bold transition-all">VazgeÃ§</button>
                <button type="submit" class="px-12 py-3 bg-violet-600 hover:bg-violet-700 text-white font-bold rounded-xl transition-all shadow-lg shadow-violet-500/20 transform hover:scale-105">
                    Kaydet
                </button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.ckeditor.com/ckeditor5/38.0.1/classic/ckeditor.js"></script>
<script>
    let diaryEditor;
    
    document.addEventListener("DOMContentLoaded", function() {
        ClassicEditor
            .create(document.querySelector('#editor_main'), {
                toolbar: [ 'heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote' ]
            })
            .then(editor => {
                diaryEditor = editor;
                console.log('EditÃ¶r baÅŸarÄ±yla yÃ¼klendi');
            })
            .catch(error => {
                console.error(error);
            });
    });

    function openModal() {
        document.getElementById('add-modal').classList.remove('hidden');
        if (diaryEditor) {
            diaryEditor.editing.view.focus();
        }
    }
    
    function closeModal() {
        document.getElementById('add-modal').classList.add('hidden');
    }

    function toggleEmotion(show) {
        const section = document.getElementById('emotion-section');
        if(show) {
            section.classList.remove('hidden');
        } else {
            section.classList.add('hidden');
        }
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
        document.getElementById('tab-' + tabName).classList.remove('hidden');
        
        const btnGunluk = document.getElementById('tab-btn-gunluk');
        const btnYillik = document.getElementById('tab-btn-yillik');
        
        btnGunluk.className = "px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white";
        btnYillik.className = "px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-white";
        
        const activeBtn = document.getElementById('tab-btn-' + tabName);
        activeBtn.className = "px-6 py-2 rounded-lg text-sm font-bold transition-all bg-violet-600 text-white shadow-lg shadow-violet-500/20";
    }
</script>

<style>
    .editor-container {
        min-height: 300px;
    }
    .ck-editor__editable {
        min-height: 300px !important;
        max-height: 500px !important;
        background-color: #1e293b !important; /* bg-slate-800 */
        color: #e2e8f0 !important;
        border-bottom-left-radius: 0.75rem !important;
        border-bottom-right-radius: 0.75rem !important;
        border: 1px solid #334155 !important;
    }
    .ck-toolbar {
        background-color: #0f172a !important; /* bg-slate-900 */
        border-color: #334155 !important;
        color: #e2e8f0 !important;
        border-top-left-radius: 0.75rem !important;
        border-top-right-radius: 0.75rem !important;
    }
    .ck.ck-toolbar .ck-toolbar__items {
        background-color: #0f172a !important;
    }
    .ck.ck-button {
        color: #e2e8f0 !important;
    }
    .ck.ck-button:hover {
        background-color: #1e293b !important;
    }
    .ck.ck-button.ck-on {
        background-color: #334155 !important;
        color: #a78bfa !important;
    }
    .ck.ck-editor__main > .ck-editor__editable:focus {
        border-color: #7c3aed !important;
        box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2) !important;
    }
</style>
{% endblock %}